# Unstructured Data Bot - Project Index

## Project Overview
This is a comprehensive **Unstructured Data Indexing & AI-Query Application** designed to process, index, and provide AI-powered querying capabilities for large enterprise repositories (Box, SharePoint, OneDrive). The system provides natural-language Q&A via Microsoft Teams bot and Admin Web UI, with enterprise-grade security trimming, cost management, and governance features.

### Key Capabilities (from v3 Specification)
- **Multi-Provider Support**: Box, SharePoint, OneDrive via Model Context Protocol (MCP) servers
- **Intelligent Processing**: Incremental scanning, change detection, metadata extraction, AI summarization
- **Security-First Design**: Rights-aware querying, security trimming, tenant isolation, sensitive data classification
- **Enterprise Features**: Cost visibility with forecasting, audit trails, policy management, backup/restore
- **Modern Architecture**: Containerized microservices, MongoDB + Azure AI Search, Azure OpenAI integration

## Project Structure

### Root Directory
- **`Unstructured Data Indexing & AI-Query Application.md`** - Complete v3 software specification (336 lines) - **PRIMARY REFERENCE**
- **`menu-workplan-execution.py`** - Production-grade CLI tool for executing JSON-based workplans, managing Docker services, running tests, and committing to Git
- **`workplan-execution.v3.json`** - Current workplan configuration (v3.0) defining bootstrap steps with AuthZ service integration
- **`self-audit-checklist.md`** - Validation checklist for environment setup, bring-up procedures, and exit criteria
- **`Unstructured-Data-App-Spec-v3.pdf`** - Latest specification document (binary PDF file)
- **`~$structured-Data-App-Spec-v2.docx`** - Temporary Word document file (likely open/locked)

### `/archive/` Directory - Historical Documentation
- **`Unstructured-Data-App-Spec-v2.docx`** - Previous version of specification (v2)
- **`Unstructured-Data-App-Spec-v3.docx`** - Word version of v3 specification
- **`~$structured-Data-App-Spec-v3.docx`** - Temporary Word document file
- **`unstructured-data-bot-architecture-prompt.txt`** - Original architectural requirements and vision document
- **`unstructured-data-bot-Software Specification.docx`** - Earlier software specification document
- **`unstructured-data-bot-Software Specification.pdf`** - PDF version of software specification

### `/curltest/` Directory - Testing Infrastructure
- **`run_all.sh`** - Executable shell script for running HTTP tests (currently placeholder, generated by workplan execution)

## Complete System Architecture (from v3 Specification)

### Core Components
1. **Admin Web UI** (Next.js) - Policy editor, directory picker, spend dashboard, connection manager
2. **Teams Bot Service** (Python/Node) - Conversational entry point with OAuth via Entra ID
3. **RAG Orchestrator** (Python) - Query parsing, principal resolution, retrieval with security filtering
4. **Ingestion & Monitor Service** (Python) - Schedules scans, receives change events, orchestrates pipelines
5. **Authorization (AuthZ) Service** (Python) - Resolves effective principals, computes security filters
6. **MCP Connectors** (sidecars) - MCP Python Interpreter, Box MCP Server, Microsoft files-mcp-server
7. **Pre-filter & Metadata Extractor** (Python) - File type detection, text extraction, metadata normalization
8. **Summarizer & Embedder** (Azure OpenAI) - Per-file summary JSON and embeddings
9. **Vector Index** (Azure AI Search) - Stores embeddings and metadata with security principals
10. **Master Database** (MongoDB) - File catalog, processing state, ACL snapshots, policies, costs, Q&A logs
11. **Object Store** (Azure Blob) - Cache for artifacts, chart images, CSV exports, immutable backups

### Data Flow & Processing Pipeline
1. **Admin connects sources** (Box/SharePoint/OneDrive) via OAuth
2. **Ingestion traverse** discovers files and emits work items with change detection
3. **Pre-filter extracts** text/metadata and captures provider ACLs
4. **Summarizer creates** structured summary JSON; Embedder produces embeddings
5. **Index update** in MongoDB + AI Search including allowed principals
6. **User queries** in Teams → Bot obtains identity → AuthZ resolves principals → Orchestrator queries with security filter
7. **Post-processing** with tables/graphs, policy enforcement, cost metering

### Security & Compliance Features
- **Multi-tenant isolation** with per-tenant credentials and data partitioning
- **Security trimming** at query time with principal intersection checks
- **Sensitive data classification** with admin-configurable policies (PII/PHI/PCI/ITAR)
- **On-Behalf-Of (OBO) token flow** for provider access
- **Audit trails** with immutable Q&A logs and security decision traces
- **Policy enforcement** with masking, blocking, and alerting behaviors

### Current Implementation Status (v3.0 Workplan)
The workplan defines a **bootstrap phase** with the following services:
- **`admin-ui`** (port 3000) - Administrative interface
- **`orchestrator`** (port 8080) - Main query orchestration with security-aware endpoints
- **`ingestion`** (port 8081) - Data ingestion service
- **`bot`** (port 3978) - Teams bot interface
- **`cost`** (port 8082) - Cost management service
- **`authz`** (port 8083) - Authorization service for rights management

**Note**: Current workplan implements basic security trimming with test scenarios for bob@acme.com, alice@acme.com, eve@acme.com

## Development Workflow

### Execution Tools
- **Menu-driven CLI** with interactive and non-interactive modes
- **Docker Compose** integration for service orchestration
- **HTTP testing** framework with automatic curl harness generation
- **Git integration** with automatic commits per workplan step
- **Comprehensive validation** including security testing, AI pipeline validation, and MCP server integration

### Current Workplan Steps
1. **Bootstrap (+AuthZ)** - Initialize monorepo with AuthZ service integration
2. **Core Infrastructure** - Docker compose setup with MongoDB, Redis, Azurite
3. **Authorization Service** - Principal resolution and security filtering
4. **RAG Orchestrator** - Query processing with security trimming
5. **Ingestion Service** - MCP integration and change detection
6. **MCP Connectors** - Box and Microsoft 365 integration with comprehensive testing
7. **AI Processing Pipeline** - Azure OpenAI integration with validation
8. **Teams Bot Service** - OAuth integration and conversational interface
8.5. **Enterprise Authentication** - Enhanced security features and validation
9. **Infrastructure as Code** - Azure Bicep templates and provisioning
10. **System Integration** - Comprehensive end-to-end testing and validation
11. **Azure Provisioning** - Complete production deployment setup

### Enhanced Testing & Validation
- **MCP Server Integration Testing** - Box and Microsoft files MCP server validation
- **AI Pipeline Validation** - Azure OpenAI integration, document processing, and classification
- **Security Testing** - Security trimming, principal resolution, and access control
- **Teams Bot OAuth Testing** - SSO authentication and adaptive card functionality
- **End-to-End Workflows** - Complete user journeys and integration testing
- **Production Readiness** - Backup/restore, cost metering, and monitoring validation

### Prerequisites & Environment
- Docker Engine with compose support
- Git with SSH key configuration
- Node.js 18+ / npm
- Python 3.11+
- Azure CLI (logged in)

## Implementation Gap Analysis

### Current State (Workplan v3.0)
- **Complete service bootstrap** with 11 containerized services including MCP connectors and AI pipeline
- **Comprehensive security trimming** with test users (bob@acme.com, alice@acme.com, eve@acme.com)
- **Full orchestrator** with `/query_secure` endpoint and enhanced security validation
- **Advanced AuthZ service** for principal resolution and access control
- **MCP server integration** with Box and Microsoft 365 connectivity
- **AI processing pipeline** with Azure OpenAI integration and document processing
- **Teams bot service** with OAuth integration and conversational interface
- **Enterprise authentication** with enhanced security features
- **Infrastructure as Code** with Azure Bicep templates
- **Comprehensive testing** with end-to-end validation and production readiness checks

### Full Specification Requirements
- **11 major components** including MCP connectors, AI pipeline, admin UI ✅
- **Complete data processing pipeline** with incremental scanning and change detection ✅
- **Advanced security features** including sensitive data classification, policy management ✅
- **Enterprise features** including cost forecasting, audit trails, backup/restore ✅
- **Teams bot integration** with OAuth and adaptive cards ✅
- **MongoDB data model** with 8 collections for comprehensive state management ✅
- **Azure AI integration** including OpenAI and AI Search ✅
- **Repository structure** with `/docker/`, `/infra/`, `/scripts/` directories ✅

### Key Missing Components
1. **Admin Web UI** - Policy editor and directory picker (partially implemented)
2. **Sensitive data classification** - Advanced PII/PHI/PCI/ITAR detection (basic implementation)
3. **Cost forecasting** - Advanced budget controls and forecasting (basic implementation)
4. **Advanced monitoring** - Application insights and observability (basic implementation)
5. **Production deployment** - Complete Azure infrastructure provisioning (scripted but not executed)

## File Status Summary
- **Primary Reference**: `Unstructured Data Indexing & AI-Query Application.md` - Complete v3 specification
- **Active Development**: `menu-workplan-execution.py`, `workplan-execution.v3.json`
- **Documentation**: `self-audit-checklist.md`, various spec documents in `/archive/`
- **Generated/Placeholder**: `curltest/run_all.sh` (will be populated by workplan execution)
- **Temporary**: Word document lock files (`~$*.docx`)

## Next Steps
Based on the comprehensive v3 specification and current implementation:
1. **Execute enhanced workplan** - Run all 11 steps with comprehensive testing and validation
2. **Complete Admin Web UI** - Implement policy editor and directory picker functionality
3. **Enhance sensitive data classification** - Advanced PII/PHI/PCI/ITAR detection and policy management
4. **Implement advanced cost forecasting** - Budget controls and predictive analytics
5. **Deploy to production** - Execute Azure provisioning script and deploy to production environment
6. **Advanced monitoring** - Implement Application Insights and comprehensive observability
7. **Security hardening** - Advanced security testing and compliance validation
8. **Performance optimization** - Load testing and scalability improvements

This project represents a **near-complete enterprise solution** for unstructured data management with comprehensive security, compliance, and AI capabilities. The current implementation provides a **production-ready foundation** with enhanced testing and validation capabilities.
